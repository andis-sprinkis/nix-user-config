#!/usr/bin/env sh

# TODO: convert to POSIX sh

case "$@" in
  http://*|https://*)
    exec web_browser_desktop "$@"
  ;;
  file://*)
    no_pre=$(echo "$@" | sed -n 's/file:\/\///p')
    path_file=$(readlink -f "$(printf '%b\n' "${no_pre//%/\\x}")")
  ;;
  *)
    path_file="$(readlink -f "$@")"
  ;;
esac

[ "$path_file" ] && {
  mime="$(file --mime-type -b "$path_file")"
  [ "$mime" ] && xdg_handler="$(xdg-mime query default "$mime")"
  echo "$xdg_handler"

  exec "/usr/bin/xdg-open" "$path_file"
}

[ -z "$xdg_handler" ] && {
  echo "$(basename "$0"): Preventing parameter without a recognized handler from being passed to /usr/bin/xdg-open"
  exit 1
}

exec "/usr/bin/xdg-open" "$@"
