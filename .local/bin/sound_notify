#!/usr/bin/env sh
set -eu

if pidof -q "notify-send"; then
  exit
fi

status="$(wpctl "get-volume" "$1")"

if [ -z "$status" ]; then
  exit
fi

vol_float="${status##Volume: }"
vol_float="${vol_float%% *}"
vol_int="$(awk "BEGIN{print 100*${vol_float}}")"
muted="${status##Volume: * }"
muted="${muted##Volume: *}"

dev_label=""

if [ "$1" != "@DEFAULT_SINK@" ]; then 
  dev_label=" (${1})"
fi

if ! pidof -q "notify-send"; then
  notify-send \
    -a "Sound volume${dev_label}" \
    -u "low" \
    -t "1150" \
    -h "string:x-canonical-private-synchronous:sound" \
    -h "int:value:${vol_int}" \
    "${vol_int}%${muted:+, MUTED}"
fi
