#!/usr/bin/env sh
set -eu

if pidof -q "notify-send"; then
  exit
fi

status="$(wpctl "get-volume" "$1")"

if [ -z "$status" ]; then
  exit
fi

vol_float="${status##Volume: }"
vol_float="${vol_float%% *}"
vol_int="$(awk "BEGIN{print 100*${vol_float}}")"
muted="${status##Volume: * }"
muted="${muted##Volume: *}"

if ! pidof -q "notify-send"; then
  notify-send \
    -a "Sound volume" \
    -t "1100" \
    -h "string:x-canonical-private-synchronous:volume" \
    -h "int:value:${vol_int}" \
    "${vol_int}%${muted:+, MUTED}
(${1})"
fi
