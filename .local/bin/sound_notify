#!/usr/bin/env sh
set -eu

if pidof -q "notify-send"; then
  exit
fi

status="$(wpctl "get-volume" "$1")"

if [ -z "$status" ]; then
  exit
fi

vol_float="${status##Volume: }"
vol_float="${vol_float%% *}"
vol_int="$(echo "100 * ${vol_float}" | bc)"
vol_int="${vol_int%%.*}"
vol_int="${vol_int:-"0"}"
muted="${status##Volume: * }"
muted="${muted##Volume: *}"

if ! pidof -q "notify-send"; then
  notify-send \
    -a "Sound volume" \
    -u "low" \
    -t "1200" \
    -h "string:x-canonical-private-synchronous:volume" \
    -h "int:value:${vol_int}" \
    "${vol_int}%${muted:+, MUTED}
Device: ${1}"
fi
