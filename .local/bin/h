#!/usr/bin/env sh
set -eu

line="$(
  (
    man -k ''  | sed -e 's/^/ man: /g'
    info -k '' | sed -e 's/^/info: /g'
    tldr -l    | sed -e 's/^/tldr: /g'
  ) | fzf -e --preview='h_preview {}' -q "${1:-""}"
)"

case "$(echo "$line" | cut -d":" -f1)" in
  " man")
    cmd="$(echo "$line" | cut -d" " -f3)"
    section="$(echo "$line" | cut -d" " -f4 | sed -e "s/(//g" -e "s/)//g")"

    echo "man \"${section}\" \"${cmd}\""
    man "$section" "$cmd"
  ;;
  "info")
    manual="$(echo "$line" | sed -e 's/info: "\(.*.\)" -- .*/\1/g')"
    indice="$(echo "$line" | sed -e 's/info: ".*." -- \(.*\)/\1/g')"

    echo "info \"${manual}\" -- \"${indice}\""
    info "$manual" -- "$indice"
  ;;
  "tldr")
    page="$(echo "$line" | cut -d" " -f2)"

    echo "tldr \"${page}\""
    tldr "$page"
  ;;
  *)
    exit "1"
  ;;
esac
