#!/usr/bin/env sh
set -eu

[ "$1" ] || exit "2"

device=""

case "${2:-"output"}" in
  "source")
    device="@DEFAULT_AUDIO_SOURCE@"
  ;;
  "output")
    device="@DEFAULT_SINK@"
  ;;
  *)
    device="$2"
  ;;
esac

case "$1" in
  "mute")
    wpctl "set-mute" "$device" "1"
  ;;
  "toggle")
    wpctl "set-mute" "$device" "toggle"
  ;;
  "unmute")
    wpctl "set-mute" "$device" "0"
  ;;
  "-")
    wpctl "set-volume" "$device" "3%-"
  ;;
  "+")
    wpctl "set-volume" "$device" "3%+"
  ;;
  *"%-")
    wpctl "set-volume" "$device" "${1%%"%-"}%-"
  ;;
  *"%+")
    wpctl "set-volume" "$device" "${1%%"%+"}%+"
  ;;
  *)
    exit "2"
  ;;
esac

[ "$(pidof "i3blocks")" ] && pkill "-SIGRTMIN+3" "i3blocks" 1> "/dev/null" 2> "/dev/null" & disown
