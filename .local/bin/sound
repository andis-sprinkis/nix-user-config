#!/usr/bin/env sh
set -eu

[ "$1" ] || exit "2"

device=""
change="3"
signal="3"

case "${2:-"output"}" in
  "source")
    device="@DEFAULT_AUDIO_SOURCE@"
  ;;
  "output")
    device="@DEFAULT_SINK@"
  ;;
  *)
    device="$2"
  ;;
esac

case "$1" in
  "mute")
    wpctl "set-mute" "$device" "1"
  ;;
  "toggle")
    wpctl "set-mute" "$device" "toggle"
  ;;
  "unmute")
    wpctl "set-mute" "$device" "0"
  ;;
  "-"|*"%-")
    wpctl "set-volume" "$device" "${change}%-"
  ;;
  "+"|*"%+")
    wpctl "set-volume" "$device" "${change}%+"
  ;;
  *)
    exit "2"
  ;;
esac

[ "$(pidof "i3blocks")" ] && {
  pkill "-SIGRTMIN+${signal}" "i3blocks" 1> "/dev/null" 2> "/dev/null" & disown
}
