#!/bin/sh

# TODO: rewrite this with getopts

# set an ssh host connection alias command
# $1 - shortname
# $2 - user@host
# $3 - port
# [$4] - remote dir for sshfs mount
# [$5] - identity file
# 
# Example:
# ssh_set_alias vps0 user@192.168.1.11 22 / ~/.ssh/key
# Resulting aliases:
# ssh_vps0 - interactive shell session user@192.168.1.11 22 with key ~/.ssh/key
# sshfs_vps0 - mount in /mnt/vps0

ssh_set_alias() {
  shortname="$1"
  user_at_host="$2"
  port="$3"
  dir_remote="$4"
  dir_local="$5"
  file_identity="$6"

  alias \
    ssh_${shortname}="autossh -M 0 ${user_at_host} -p ${port} $([ "${file_identity}" ] && echo "-i ${file_identity}")" \
    sshfs_${shortname}="sshfs -p ${port} -o allow_other -o reconnect -o ServerAliveInterval=15 ${user_at_host}:$([ "${dir_remote}" ] && echo "${dir_remote}" || echo "/") /mnt/${shortname} -C $([ "${file_identity}" ] && echo "-o IdentityFile=${file_identity}")"
}
