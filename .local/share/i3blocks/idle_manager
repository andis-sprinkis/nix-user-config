#!/usr/bin/env sh

status="$(idle_manager_status)"

[ "$BLOCK_BUTTON" ] && {
  reload() {
    (sleep 1; pkill -SIGRTMIN+10 i3blocks) 1>/dev/null 2>/dev/null & disown
  }

  _screen_lock() {
    echo "Idle lock"
    screen_lock 1>/dev/null 2>/dev/null & disown
    exit
  }

  _idle_manager_enable() {
    echo "Starting the idle manager..."
    idle_manager_enable 1>/dev/null 2>/dev/null & disown
    reload
    exit
  }

  _idle_manager_disable() {
    echo "Stopping the idle manager..."
    idle_manager_disable 1>/dev/null 2>/dev/null & disown
    reload
    exit
  }

  case "$BLOCK_BUTTON" in
    "1") case "$status" in
        "enabled") _screen_lock ;;
        "disabled") _idle_manager_enable ;;
      esac
    ;;
    "3") case "$status" in
        "enabled") _idle_manager_disable ;;
        "disabled") _idle_manager_enable ;;
      esac
    ;;
  esac
}

case "$status" in
  "enabled") echo "Idle lock" ;;
  "disabled") echo "Idle mgr. inactive" ;;
esac
