#!/usr/bin/env sh

if [ "$(id -u)" -lt 1000 ]; then
  echo "$(basename "$0"): Must not use a system account" 2>&1
  exit 1
fi

xrdb -load "${XDG_CONFIG_HOME:-$HOME/.config}/xresources/.Xresources"

pid_xsettingsd="$(pidof xsettingsd)"
if [ "$pid_xsettingsd" ]; then 
  kill -HUP "$pid_xsettingsd"
else 
  xsettingsd -b &
fi

VBoxClient-all &
xset b off &
xset r rate 165 55 &
xkbcomp -I"${XDG_CONFIG_HOME:-$HOME/.config}/xkb" "${XDG_CONFIG_HOME:-$HOME/.config}/xkb/keymap/kbd" "$DISPLAY" &
[ -z "$(pidof unclutter)" ] && unclutter --timeout 1 --start-hidden &
hsetroot -solid "$(xrdb -get background)" &

pid_picom="$(pidof picom)"
if [ "$pid_picom" ]; then 
  kill -USR1 "$pid_picom"
else 
  picom -b &
fi

if [ "$(pidof xscreensaver)" ]; then 
  xscreensaver-command --restart
else
  xscreensaver -no-splash & 
fi

[ -z "$(pidof xss-lock)" ] && xss-lock --ignore-sleep -- xscreensaver-command -lock &

if [ "$(pidof i3)" ]; then 
  i3-msg restart
else
  exec i3
fi
