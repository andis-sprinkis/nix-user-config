set  -g  aggressive-resize  on
set  -g  base-index         1
set  -g  default-command    "$SHELL"
set  -g  default-terminal   "xterm-256color"
set  -g  display-panes-time 5000
set  -g  display-time       5000
set  -g  focus-events       on
set  -g  history-file       "$HOME/.cache/tmux/history"
set  -g  history-limit      500
set  -g  monitor-activity   off
set  -g  mouse              on
set  -g  prefix-timeout     5000
set  -g  renumber-windows   on
set  -g  repeat-time        700
set  -g  set-titles         on
set  -g  status             off
set  -g  status-keys        vi
set  -g  status-position    top
set  -g  visual-activity    off
set  -ga terminal-overrides ",xterm-256color:Tc"
set  -s  escape-time        0
setw -g  automatic-rename   on
setw -g  mode-keys          vi
setw -g  pane-base-index    1

# Title templates
%hidden _status_pane_mode="#{?pane_in_mode,[#{pane_mode}] ,}"
%hidden _status_session="#{session_name}#{?session_marked,M,}"
%hidden _status_window="#{active_window_index}#{?window_active,,}#{?window_activity_flag,##,}#{?window_bell_flag,!,}#{?window_last_flag,-,}#{?window_marked_flag,M,}#{?window_silence_flag,~,}#{?window_zoomed_flag,Z,}"
%hidden _status_pane="#{pane_index}#{?pane_marked,M,}"
%hidden _status_pane_title="#{user}@#{host} - #{pane_title}"

# Terminal window title
set -g set-titles-string "${_status_pane_mode}[${_status_session}:${_status_window}:${_status_pane}] ${_status_pane_title}"

# Status bar

## Background and foreground
set -g status-bg black
set -g status-fg darkgray

## Status left
set -g status-left        "[${_status_session}:${_status_window}:${_status_pane}] "
set -g status-left-length 12

## Window status
set -g window-status-current-style 'fg=white'
set -g window-status-bell-style    'fg=yellow'

## Status right
set -g status-right        "${_status_pane_title}"
set -g status-right-length 60

## Command prompt and messages
set -g message-style         'bg=default fg=cyan'
set -g message-command-style 'bg=default fg=white'

## Mode
set -g mode-style 'bg=brightblack fg=black'

# Pane border
set -g pane-border-style        'bg=default fg=brightblack'
set -g pane-active-border-style 'bg=default fg=cyan'
set -g pane-border-status       off
set -g pane-border-lines        single
set -g pane-border-format       "#[align=left]#[fg=brightblack]#{?pane_active,#[fg=cyan],#[fg=brightblack]}#{=/#{e|-:#{pane_width},18}/.. : ${_status_pane_mode}${_status_pane_title}} #[align=right] ${_status_session}:${_status_window}:${_status_pane} "

# Menu
set -g menu-selected-style 'bg=brightblack fg=black'

# Hooks

## Custom hooks
set-hook -g @toggle-status {
  if -b "[ \#{session_windows} -eq 1 ]" {
    set status off
  } {
    set status on
  }
}

set-hook -g @toggle-pane-border-status {
  if -b "[ \#{window_panes} -eq 1 ]" {
    set pane-border-status off
  } {
    set pane-border-status top
  }
}

set-hook -g @even-pane-sizes {
  run -b \
    "if [ \#{window_panes} -eq \"1\" ]; then exit; fi \n\
     \n\
     for p in \$(tmux list-panes -F \"##P\" -t \"#I\"); do \n\
       tmux select-layout -E -t \"\$p\" \n\
     done"
}

## Native hooks
set-hook -g after-new-session {
  set-hook -R @toggle-status
  set-hook -R @toggle-pane-border-status
}

set-hook -g after-new-window {
  set-hook -R @toggle-status
  set-hook -R @toggle-pane-border-status
}

set-hook -g after-kill-pane {
  set-hook -R @toggle-status
  set-hook -R @toggle-pane-border-status
}

set-hook -g after-split-window {
  set-hook -R @toggle-status
  set-hook -R @toggle-pane-border-status
  set-hook -R @even-pane-sizes
}

set-hook -g client-resized {
  set-hook -R @even-pane-sizes
}

set-hook -g pane-exited {
  set-hook -R @toggle-status
  set-hook -R @toggle-pane-border-status
  set-hook -R @even-pane-sizes
}

# Key bindings

## Swap: C-b to C-Space for as the prefix
set    -g prefix C-Space
unbind -T prefix C-b
bind   -T prefix -N "Send prefix (user)" C-Space send-prefix
## Claimed (prefix): C-Space
## Freed   (prefix): C-b

## Bind: <prefix>-R to the reload tmux.conf
bind -T prefix -N "Reload tmux.conf (user)" R {
  source-file ~/.config/tmux/tmux.conf
  display 'tmux.conf reloaded'
}
## Claimed (prefix): R

## Bind: <prefix>-t to toggle the status
unbind -T prefix t # Default (prefix): Show a clock
bind   -T prefix -N "Toggle status line (user)" t set status
## Replaced (prefix): t

## Swap: <prefix>-\" to <prefix>-v for splitting window vertically
unbind -T prefix \" # Default: Split window vertically
bind   -T prefix -N "Split window vertically (user)" v split-window -v
## Claimed (prefix): v
## Freed   (prefix): \"

## Swap: <prefix>-\% to <prefix>-o for splitting window horizontally
unbind -T prefix \% # Default (prefix): Split window horizontally
unbind -T prefix o  # Default (prefix): Select next pane
bind   -T prefix -N "Split window horizontally (user)" o  split-window -h
bind   -T prefix -N "Select the next pane (user)"      \% select-pane -t :.+
## Replaced (prefix): \%, o

## Bind:
bind   -T prefix -N "Split window horizontally full height (user)" O split-window -hf
## Claimed (prefix): O

## Bind:
bind -T prefix -N "Split window vertically full width (user)" V split-window -vf
## Claimed (prefix): V

## Bind:
unbind -T prefix C-o # Default (prefix): Rotate through the panes
unbind -T prefix M-o # Default (prefix): Rotate through the panes in reverse
bind -T prefix -N "Split window horizontally left (user)" M-o split-window -hb
## Replaced (prefix): M-o
## Freed    (prefix): C-o

## Bind:
bind -T prefix -N "Split window vertically above (user)" M-v split-window -b
## Claimed (prefix): M-v

## Bind:
bind -T prefix -N "Split window horizontally full height left (user)" C-M-o split-window -hbf
## Claimed (prefix): C-M-o

## Bind:
bind -T prefix -N "Split window vertically full width above (user)" C-M-v split-window -vbf
## Claimed (prefix): C-M-v

## Swap: <prefix>-Left/Down/Up/Right to <prefix>-h/j/k/l for selecting the pane in the direction from the current pane
unbind -T prefix l     # Default (prefix): Select the previously current window
unbind -T prefix Left  # Default (prefix): Select the pane to the left of the active pane
unbind -T prefix Down  # Default (prefix): Select the pane below the active pane
unbind -T prefix Up    # Default (prefix): Select the pane above the active pane
unbind -T prefix Right # Default (prefix): Select the pane to the right of the active pane
bind   -T prefix -N "Select the previously current window (user)"               \" last-window
bind   -T prefix -N "Select the pane to the left of the active pane (user)"  -r h  select-pane -L
bind   -T prefix -N "Select the pane below the active pane (user)"           -r j  select-pane -D
bind   -T prefix -N "Select the pane above the active pane (user)"           -r k  select-pane -U
bind   -T prefix -N "Select the pane to the right of the active pane (user)" -r l  select-pane -R
## Claimed    (prefix): h, j, k
## Replaced   (prefix): l
## Freed      (prefix): Left, Down, Up, Right
## Re-claimed (prefix): "\

## Swap: <prefix>-C-Left/Down/Up/Right to <prefix>-C-h/j/k/l for resizing the pane in the direction specified
unbind -T prefix C-Up    # Default (prefix): Resize the pane up
unbind -T prefix C-Down  # Default (prefix): Resize the pane down
unbind -T prefix C-Left  # Default (prefix): Resize the pane left
unbind -T prefix C-Right # Default (prefix): Resize the pane right
unbind -T prefix M-Up    # Default (prefix): Resize the pane up by 5
unbind -T prefix M-Down  # Default (prefix): Resize the pane down by 5
unbind -T prefix M-Left  # Default (prefix): Resize the pane left by 5
unbind -T prefix M-Right # Default (prefix): Resize the pane right by 5
bind   -T prefix -N "Resize the pane up by 2 (user)"    -r C-k resize-pane -U 2
bind   -T prefix -N "Resize the pane down by 2 (user)"  -r C-j resize-pane -D 2
bind   -T prefix -N "Resize the pane left by 4 (user)"  -r C-h resize-pane -L 4
bind   -T prefix -N "Resize the pane right by 4 (user)" -r C-l resize-pane -R 4
## Claimed (prefix): C-k, C-j, C-h, C-l
## Freed   (prefix): C-Left, C-Down, C-Up, C-Right, M-Left, M-Down, M-Up, M-Right

## Swap: <prefix>-S-Left/Down/Up/Right to <prefix>-S-h/j/k/l moving the visible part of the window in the direction specified
unbind -T prefix S-Up    # Default (prefix): Move the visible part of the window up
unbind -T prefix S-Down  # Default (prefix): Move the visible part of the window down
unbind -T prefix S-Left  # Default (prefix): Move the visible part of the window left
unbind -T prefix S-Right # Default (prefix): Move the visible part of the window right
bind   -T prefix -N "Move the visible part of the window up (user)"    -r S-k refresh-client -U 10
bind   -T prefix -N "Move the visible part of the window down (user)"  -r S-j refresh-client -D 10
bind   -T prefix -N "Move the visible part of the window left (user)"  -r S-h refresh-client -L 10
bind   -T prefix -N "Move the visible part of the window right (user)" -r S-l refresh-client -R 10
## Claimed (prefix): S-k, S-j, S-h, S-l
## Freed   (prefix): S-Up, S-Down, S-Left, S-Right

## Bind:
bind -T prefix -N "Swap the active pane with the pane above (user)" -r M-k {
  select-pane -m
  select-pane -U
  swap-pane
  select-pane -U
  select-pane -M
}
## Claimed (prefix): M-k

## Bind:
bind -T prefix -N "Swap the active pane with the pane below (user)" -r M-j {
  select-pane -m
  select-pane -D
  swap-pane
  select-pane -D
  select-pane -M
}
## Claimed (prefix): M-j

## Bind:
bind -T prefix -N "Swap the active pane with the pane to the left (user)" -r M-h {
  select-pane -m # Set the current pane as the marked pane
  select-pane -L # Set the pane left to the marked pane as active
  swap-pane      # Swap active pane and marked pane (swaps the marked state too)
  select-pane -L # Set the pane left to the marked pane as active
  select-pane -M # Clear the marked pane state
}
## Claimed (prefix): M-h

## Bind:
bind -T prefix -N "Swap the active pane with the pane to the right (user)" -r M-l {
  select-pane -m
  select-pane -R
  swap-pane
  select-pane -R
  select-pane -M
}
## Claimed (prefix): M-l

## Bind:
bind -T copy-mode-vi -N "Copy selection (user)" y {
  send -X copy-selection -x
}
## Claimed (copy-mode-vi): y

## Bind:
bind -T copy-mode-vi -N "Select pane and clear selection (user)" MouseDown1Pane {
  select-pane
  send -X clear-selection
}
## Replaced (copy-mode-vi): MouseDown1Pane

## Bind:
bind -T prefix -N "Open pane copy in editor split (user)" e run "$HOME/.local/share/tmux/editor_pane_copy"
## Claimed (prefix): e

## Bind: Staying in the copy-mode-vi after mouse events
unbind -T copy-mode-vi MouseDragEnd1Pane # Default (copy-mode-vi): Copy selection, unselect
unbind -T copy-mode-vi DoubleClick1Pane  # Default (copy-mode-vi): Select and copy word, unselect
unbind -T copy-mode-vi TripleClick1Pane  # Default (copy-mode-vi): Select and copy line, unselect
## Freed (copy-mode-vi): MouseDragEnd1Pane, DoubleClick1Pane, TripleClick1Pane
